<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<html>
<head>
<link rel="stylesheet" href="scripts/lib/jquery-ui/jquery-ui.min.css">
<!--
Vispy.js requires jQuery & jQueryUI.
-->
<script src="scripts/lib/jquery.min.js"></script>
<script src="scripts/lib/jquery-ui/jquery-ui.min.js"></script>
<script src="dist/vispy.min.js"></script>
<script>

function initialize_canvas(canvas_id) {
    var c = vispy.init(canvas_id);

    // Initialize the scene.
    c.on_initialize(function(event) {
    });

    c.on_key_press(function(event) {
        console.log(event);
    });

//    c.on_load(function(event) {
  //  });


    c.initialize();
//    c.resize();  // resize triggers an paint event.

    // Toggle comments below to have the canvas span the entire window.
    // Also, need to set #mycanvas width and height to 100% in the CSS.
//    c.resizable();
    // window.onresize = function(event) {
    //     c.resize();
    // };

    return c;

}


$(document).ready(function() {

    var c = initialize_canvas("#mycanvas");
    initialize_canvas("#mycanvas2");

    // Toggle fullscreen for the canvas when 'f' is pressed.
    $(window).keypress(function(e) {
        if (String.fromCharCode(e.which) == 'f') {
            // c.$el.width("100%").height("100%");
            c.toggle_fullscreen();
        }
    });

    // Start the event loop using requestanimationframe() (HTML5 spec).
    vispy.start_event_loop();

});

</script>
<style>
#mycanvas, #mycanvas2 {
    /*width: 100%;*/
    /*height: 100%;*/
    width: 200px;
    height: 50px;
    margin: 10px 0;
    padding: 0;
    cursor: default;
}
</style>
</head>
<body>

<canvas id="mycanvas"></canvas>
<canvas id="mycanvas2"></canvas>

<form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">

  <fieldset>
    <h2>Json File</h2>
     <input type='file' id='fileinput'>
     <input type='button' id='btnLoad' value='Load' onclick='loadFile();'>
  </fieldset>
</form>

<script type="text/javascript">

  function loadFile() {
    var input, file, fr;

    if (typeof window.FileReader !== 'function') {
      alert("The file API isn't supported on this browser yet.");
      return;
    }

    input = document.getElementById('fileinput');
    if (!input) {
      alert("Um, couldn't find the fileinput element.");
    }
    else if (!input.files) {
      alert("This browser doesn't seem to support the `files` property of file inputs.");
    }
    else if (!input.files[0]) {
      alert("Please select a file before clicking 'Load'");
    }
    else {
      file = input.files[0];
      fr = new FileReader();
      fr.onload = receivedText;
      fr.readAsText(file);
    }

    function receivedText(e) {
      lines = e.target.result;
      var newArr = JSON.parse(lines);
      console.log(newArr);       

      // Cyrille: At this point, we have the commands in newArr and need to get them to the canvas.
    }
  }
</script>

</body>
</html>
